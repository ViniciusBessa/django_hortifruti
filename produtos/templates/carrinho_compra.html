{% extends 'base.html' %}
{% load static %}
{% load produtos_filters %}

{% block head %}
<script src="{% static 'alterar_carrinho.js' %}"></script>
{% endblock %}

{% block main %}
<section class="p-3">
    {% if carrinho_compra %}
    <h1 class="text-center mb-5 cor-destaque">Carrinho de compras</h1>

    <div class="row">
        <div class="col">
            <h2 class="text-center cor-destaque">Produtos</h2>
            {% for produto in carrinho_compra %}
            <div class="row justify-content-center py-4">
                <div class="col-auto d-flex justify-content-center">
                    <a href="{% url 'pagina_produto' produto.id %}"><img src="{% static produto.imagem.path %}" width="250px" height="200px"/></a>
                </div>
                <div class="col-sm-3">
                    <div>
                        <p class="mb-1">{{ produto.titulo }}</p>
                        <h5 class="cor-dinheiro">R$ {{produto.preco }}</h5>
                        <p class="d-inline">Quantidade:</p>
                        <select id="quantidade-{{ produto.id }}" onchange="alterarCarrinho('{{ produto.id }}')">
                            {% for numero in produto.estoque|range_estoque %}
                            {% if numero == produto|get_quantidade:quantidades %}
                            <option value="{{ numero }}" selected>{{ numero }}</option>

                            {% else %}
                            <option value="{{ numero }}">{{ numero }}</option>

                            {% endif %}
                            {% endfor%}
                        </select>   
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="col-md-4 d-flex justify-content-center">
            <div>
                <h2 class="cor-destaque">Subtotal</h2>
                <h4 class="cor-dinheiro">R$ {{ subtotal }}</h4>
                <form class="my-3" action="{% url 'finalizar_pedido' %}" method="GET">
                    <button class="btn btn-outline-secondary" type="submit">Finalizar o pedido</button>
                </form>    
            </div>
        </div>
    </div>

    {% else %}
    <h1 class="text-center cor-destaque">Não há nenhum produto no carrinho</h1>

    {% endif %}
</section>
{% endblock %}